---
layout: post
title: Fun with certificates – Outlook Web Access certificate error
date: '2014-09-19T14:31:00.001-04:00'
author: Damien Solodow
tags: 
modified_time: '2014-09-19T14:31:19.057-04:00'
thumbnail: http://4.bp.blogspot.com/-fJd6tjmQQEo/VBx0FoAzedI/AAAAAAAABRU/zYbnX26nFYQ/s72-c/1.png
blogger_id: tag:blogger.com,1999:blog-23185081170317196.post-8303294717979752005
blogger_orig_url: http://theevolvingadmin.blogspot.com/2014/09/fun-with-certificates-outlook-web.html
---

<h2 align="center" style="text-align: center;">The Problem:<o:p></o:p></h2><div class="MsoNormal"><span style="font-family: inherit;">We recently had a user (we’ll call them “Bob”) send in a ticket because when he tried to access&nbsp;Outlook Web Access&nbsp;from home he got a certificate error in the web browser that said the site wasn’t secure. Understandably concerned by this, he closed out the browser and contacted us.</span><o:p></o:p></div><h2 align="center" style="text-align: center;">The Diagnosis:<o:p></o:p></h2><div class="MsoNormal"><span style="font-family: inherit;">So the first order of business was to determine if it was a global issue or just poor Bob. Since no other tickets had come in, and the site loaded correctly for us here it was almost certainly just Bob having this issue.<o:p></o:p></span></div><div class="MsoNormal"><h4><span style="font-family: inherit;">A few items that made this even more interesting:</span></h4></div><div class="MsoListParagraphCxSpFirst" style="text-indent: -0.25in;"><br /><ul><li><span style="font-family: inherit; font-size: 7pt; font-stretch: normal; text-indent: -0.25in;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="font-family: inherit; text-indent: -0.25in;">Bob got this security warning on any secure Harrison websites, not just Outlook Web Access</span></li><li><span style="font-family: inherit; font-size: 7pt; font-stretch: normal; text-indent: -0.25in;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="text-indent: -0.25in;"><span style="font-family: inherit;">Bob&nbsp;</span>didn't<span style="font-family: inherit;">&nbsp;have problems with non-Harrison secure websites</span></span></li><li><span style="font-family: inherit; font-size: 7pt; font-stretch: normal; text-indent: -0.25in;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="font-family: inherit; text-indent: -0.25in;">This included secure websites that use the same certificate provider that we do (</span><a href="https://www.digicert.com/" style="font-family: inherit; text-indent: -0.25in;">DigiCert</a><span style="font-family: inherit; text-indent: -0.25in;">)</span></li><li><span style="font-family: inherit; font-size: 7pt; font-stretch: normal; text-indent: -0.25in;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="font-family: inherit; text-indent: -0.25in;">Internet Explorer and Chrome both gave a certificate warning for Harrison sites, but Firefox worked fine.</span></li></ul></div><div class="MsoNormal"><span style="font-family: inherit;">This last point is rather interesting and is actually rather telling. IE and Chrome both use the Windows certificate store, whereas Firefox maintains its own certificate store. On a&nbsp;</span>side-note<span style="font-family: inherit;">, this is why&nbsp;Firefox is problematic with non-public Certificate Authorities; you can’t deploy the root certificates to it via GPO.<o:p></o:p></span><br /><span style="font-family: inherit;"><br /></span></div><div class="MsoNormal"><span style="font-family: inherit;">So we took a look at Bob’s PC, and visited our Outlook Web Access page to get the certificate warning. We pulled up the certificate info (<a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=2&amp;cad=rja&amp;uact=8&amp;ved=0CCUQFjAB&amp;url=http%3A%2F%2Fwindows.microsoft.com%2Fen-us%2Fwindows-vista%2Fget-information-about-secure-sockets-layer-ssl-certificates&amp;ei=pCP2U_qFAYf8yQTC-oCICA&amp;usg=AFQjCNFNgiInSNqeqP0occnOc1ti-AOHnQ&amp;sig2=Z6U5wu4TKzRoHM47Q0ofEw">HowTo</a>) so we could try to find out why his browser thought something was wrong.&nbsp; Here’s what we saw:</span><o:p></o:p></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-fJd6tjmQQEo/VBx0FoAzedI/AAAAAAAABRU/zYbnX26nFYQ/s1600/1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-fJd6tjmQQEo/VBx0FoAzedI/AAAAAAAABRU/zYbnX26nFYQ/s1600/1.png" height="320" width="255" /></a></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><o:p></o:p></div><div class="MsoNormal"><span style="font-family: inherit;">The Details tab&nbsp;</span>wasn't<span style="font-family: inherit;">&nbsp;immediately helpful, but the Certification Path tab was. The Certification Path tab&nbsp;shows the&nbsp;</span><a href="http://en.wikipedia.org/wiki/Chain_of_trust" style="font-family: inherit;">Certificate Chain</a><span style="font-family: inherit;">&nbsp;for the given certificate:</span><o:p></o:p></div><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-qkB1MO2K2V0/VBx0KL_Z_eI/AAAAAAAABRc/alw5JJ2bcqM/s1600/2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://4.bp.blogspot.com/-qkB1MO2K2V0/VBx0KL_Z_eI/AAAAAAAABRc/alw5JJ2bcqM/s1600/2.png" height="320" width="254" /></a></div><div class="MsoNormal"><br /></div><div class="MsoNormal"><o:p></o:p></div><div class="MsoNormal"><span style="font-family: inherit;">Our certificate (*.harrison.edu) said that it was OK. The next one up the chain (DigiCert Secure Server CA) also said it was OK. However, the top (or root) certificate was not OK.<o:p></o:p></span></div><div class="MsoNormal"><span style="font-family: inherit;">Ah-ha! This meant that the Windows certificate store had a corrupt copy of that certificate that needed to be replaced.</span><o:p></o:p></div><h2 align="center" style="text-align: center;">The Solution:<o:p></o:p></h2><div class="MsoListParagraphCxSpFirst" style="text-indent: -0.25in;"></div><ol><li><span style="font-family: 'Times New Roman'; font-size: 7pt; font-stretch: normal; text-indent: -0.25in;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="text-indent: -0.25in;">Determine which certificate in the store needs to be replaced</span></li><li><span style="font-family: 'Times New Roman'; font-size: 7pt; font-stretch: normal; text-indent: -0.25in;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="text-indent: -0.25in;">Get a good copy of the certificate</span></li><li><span style="font-family: 'Times New Roman'; font-size: 7pt; font-stretch: normal; text-indent: -0.25in;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="text-indent: -0.25in;">Replace the bad one</span></li><li><span style="text-indent: -0.25in;">&nbsp; &nbsp; &nbsp;Test</span></li></ol><o:p></o:p><br /><div class="MsoListParagraphCxSpMiddle" style="text-indent: -0.25in;"><o:p></o:p></div><div class="MsoListParagraphCxSpMiddle" style="text-indent: -0.25in;"><o:p></o:p></div><div class="MsoListParagraphCxSpLast" style="text-indent: -0.25in;"><o:p></o:p></div><div class="MsoNormal"><span style="font-family: inherit;">Determining which certificate needed to be replaced was a matter of selecting the bad certificate (DigiCert) from the dialog shown above and clicking View Certificate.<o:p></o:p></span></div><div class="MsoNormal"><span style="font-family: inherit;">This told us that the certificate we needed was “DigiCert Global Root CA” with an expiration date of 11/9/2031.<o:p></o:p></span></div><div class="MsoNormal"><span style="font-family: inherit;">A quick Google search for “DigiCert Global Root CA” pointed us here:&nbsp;<a href="https://www.digicert.com/digicert-root-certificates.htm">https://www.digicert.com/digicert-root-certificates.htm</a><o:p></o:p></span></div><div class="MsoNormal"><span style="font-family: inherit;">Scrolling down to “DigiCert Global Root CA” showed the expected expiration data, and had a handy Download link.<o:p></o:p></span></div><div class="MsoNormal"><span style="font-family: inherit;"><span style="font-family: inherit;">Now that we had the correct and valid certificate, we just needed to replace the bad one. Here’s how that was done:</span><o:p></o:p></span></div><br /><ol><li><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Click&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Start</b><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">, click&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Start Search</b><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">, type&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">mmc</b><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">, and then press ENTER.</span></li><li><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">On the&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">File</b><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">&nbsp;menu, click&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Add/Remove Snap-in</b><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">.</span></li><li><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Under&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Available snap-ins</b><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">, click&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Certificates</b><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">,and then click&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Add</b><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">.</span></li><li><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Under&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">This snap-in will always manage certificates for</b><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">, click&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Computer account</b><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">, and then click</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">&nbsp;Next.</b></li><li><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Click&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Local computer</b><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">, and click&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Finish</b><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">.</span></li><li><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">In the console tree, double-click&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Certificates</b><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">.</span></li><li><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Click</span><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Trusted Root Certification Authorities</b><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">&nbsp;store.</span></li><li><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Scroll down to find the bad certificate (</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">DigiCert Global Root CA</b><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">)</span></li><li><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Right click the bad certificate and click</span><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Delete</b></li><li><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">This displayed a warning that we could be breaking things, but since we were about to replace it, we clicked</span><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Ok</b></li><li><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Right-click the&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Trusted Root Certification Authorities</b><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">&nbsp;store.</span></li><li><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Click&nbsp;</span><b style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">Import</b><span style="color: #2a2a2a; font-family: inherit; line-height: 13.5pt;">&nbsp;to import the certificates and follow the steps in the Certificate Import Wizard, pointing it to the certificate we’d just downloaded from DigiCert.</span></li></ol><br /><div class="MsoNormal" style="line-height: 13.5pt; margin-bottom: 0in;"><span style="color: #2a2a2a; line-height: 13.5pt;"><span style="font-family: inherit;">Once this was done, we launched IE, and visited Outlook Web Access. This time no certificate warnings came up, and Bob finally got to his email.</span></span></div>